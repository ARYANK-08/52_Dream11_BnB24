<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat</title>
</head>
<body>
    <h1>AI Chat</h1>
    <button id="startRecording">Start Recording</button>
    <div id="output"></div>
<p> {{response}} </p>
{% csrf_token %}

<script>
    const startRecordingButton = document.getElementById('startRecording');
    const outputDiv = document.getElementById('output');
    const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

    startRecordingButton.addEventListener('click', () => {
        const recognition = new window.webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.start();

        recognition.onresult = function(event) {
            const user_input = event.results[0][0].transcript;
            outputDiv.textContent = "You said: " + user_input;
            sendData(user_input);
        }

        recognition.onend = function() {
            console.log('Speech recognition ended.');
        }
    });

    function sendData(user_input) {
        fetch('/chat_with_ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // Include the CSRF token in the headers
            },
            body: JSON.stringify({ user_input: user_input })
        })
        .then(response => response.json())
        .then(data => {
            outputDiv.textContent = "AI Response: " + data.response;
            speak(data.response);
        })
        .catch(error => console.error('Error:', error));
    }

    function speak(text) {
        const utterance = new SpeechSynthesisUtterance();
        utterance.lang = 'en-US';
        utterance.text = text;
        window.speechSynthesis.speak(utterance);
    }
</script>


</body>
</html>
